<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Index Page</title>
    <script>
        // 페이지 로드 시 실행되는 함수
        window.onload = function() {
            // 로컬 스토리지에서 JWT 토큰을 가져옵니다.
            const token = localStorage.getItem('jwt');

            const loginLink = document.getElementById('login-link');
            const logoutLink = document.getElementById('logout-link');
            const greeting = document.getElementById('greeting');

            if (token) {
                // 토큰이 존재하면 로그인 상태로 간주
                loginLink.style.display = 'none';  // 로그인 링크 숨기기
                logoutLink.style.display = 'block';  // 로그아웃 링크 보이기

                // 서버에서 사용자 정보를 가져오는 요청 (예: /api/userinfo)
                fetch('/api/userinfo', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                })
                .then(response => response.json())
                .then(data => {
                    greeting.innerText = `Hello, ${data.username}!`;
                })
                .catch(error => console.error('Error fetching user info:', error));
            } else {
                // 토큰이 없으면 비로그인 상태로 간주
                loginLink.style.display = 'block';  // 로그인 링크 보이기
                logoutLink.style.display = 'none';  // 로그아웃 링크 숨기기
            }
        };

        // 로그아웃 버튼 클릭 시 처리할 함수
        function logout() {
            localStorage.removeItem('jwt');  // 로컬 스토리지에서 토큰 삭제
            window.location.reload();  // 페이지 새로고침
        }
    </script>
</head>
<body>
    <h1>Welcome to the Index Page</h1>
    <div>
        <p id="greeting"></p>
        <a id="login-link" href="/login">Login</a>
        <a id="logout-link" href="#" onclick="logout()" style="display:none;">Logout</a>
    </div>
</body>
</html>
